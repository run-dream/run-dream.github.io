---
layout: post
date: 2021-06-09 20:00:00
category: Linux
tags:
  - Linux
---

### IO系统基本结构

![基本结构](https://run-dream.github.io/img/post/linux-io-devices.webp)

CPU 并不直接和设备打交道，它们中间有一个叫作设备控制器

所有设备都在 /dev/ 文件夹下面创建一个特殊的设备文件。这个设备特殊文件也有 inode，但是它不关联到硬盘或任何其他存储介质上的数据，而是建立了与某个设备驱动程序的连接。对于设备文件，ls 出来的内容如果是字符设备文件，则以 c 开头，如果是块设备文件，则以 b 开头。

### 输入输出设备分类

- 块设备

  块设备将信息存储在固定大小的块中，每个块都有自己的地址。硬盘就是常见的块设备。

  一般处理时，需要用到缓冲区

- 字符设备

  字符设备发送或接收的是字节流。而不用考虑任何块结构，没有办法寻址。鼠标就是常见的字符设备。



### 中断

- 软中断 代码调用 INT 指令触发
- 硬件中断 硬件通过中断控制器触发的



### 驱动程序

设备驱动程序属于操作系统的一部分。操作系统的内核代码可以像调用本地代码一样调用驱动程序的代码。

可以通过

```bash
 lsmod <device>.ko
```

来加载驱动

- /sys/devices 是内核对系统中所有设备的分层次的表示；

- /sys/dev 目录下一个 char 文件夹，一个 block 文件夹，分别维护一个按字符设备和块设备的主次号码 (major:minor) 链接到真实的设备 (/sys/devices 下) 的符号链接文件；
- /sys/block 是系统中当前所有的块设备；
- /sys/module 有系统中所有模块的信息。
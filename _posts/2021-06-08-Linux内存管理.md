---
layout: post
date: 2020-12-03 16:00:00
category: Linux
tags:
  - Linux
  - 操作系统
  - 内存管理
---

## 内存管理

### [内存管理](https://jishuin.proginn.com/p/763bfbd248c0)

- 物理内存 只有内存管理模块可以操作

- 虚拟地址 每个进程看到的是独立的、互不干扰的虚拟地址空间

  - 内核空间 在高地址 内核 同一个内核空间
  - 用户空间 在低地址 普通进程 独占整个空间

- 用户态内存构成

  - Text Segment 存放二进制可执行代码
  - Data Segment  存放静态常量
  - BSS Segment 未初始化的静态变量
  - 堆（Heap）段 动态分配内存
  - Memory Mapping Segment 文件映射进内存
  - 栈（Stack）地址段  函数调用的函数栈

- 可以查看进程内存空间的布局的命令

  ```bash
  cat /proc/<pid>/map
  pmap <pid>
  ```

- 物理内存和虚拟地址映射

  - 分段机制 *Linux中段只被用于访问控制和内存保护。*

  ![分段机制](https://run-dream.github.io/img/post/linux-memory-segment.webp)

  - 分页机制 *Linux 主要使用分页的机制* *多级页表*

    	![分页机制](https://run-dream.github.io/img/post/linux-memry-page.webp)

  - 段页机制



### 进程空间管理

- 32位

  ![32位](https://run-dream.github.io/img/post/linux-process-memory-x32.webp)

- 64位

![64位](https://run-dream.github.io/img/post/linux-process-memory-x64.webp)

直接映射区: 这一块空间是连续的，和物理内存是非常简单的映射关系

查看虚拟内存和物理内存的映射关系

```bash
cat /proc/pid/pagemap
cat /proc/kpagecount
cat /proc/kpageflags
cat /proc/kpagecgroup
```

